---
description: 実装コードに対してQA・テスト設計・コード・セキュリティのペルソナでレビューを実行し、敵対的レビューを統合する
handoffs:
  - label: 修正実装
    agent: speckit.implement
    prompt: 品質レビューの指摘に基づいて修正を適用してください
    send: true
  - label: フェーズ完了レビュー
    agent: review-phase
    prompt: フェーズ完了レビューを実行してください
    send: true
---

## ユーザー入力

```text
$ARGUMENTS
```

**使用方法**: `/review-quality`

## アウトライン

1. 品質ゲートの実行
   - 型チェック
   - リンティング
   - フォーマットチェック
   - テスト
2. 実装コードとテストの読み込み
3. 4つのペルソナでレビューを実行
4. 敵対的レビュー（swarm_adversarial_review）の実行
5. フィードバックの統合
6. 判定と推奨事項を出力

## ペルソナ詳細

### QAエンジニア
**観点**: テスト網羅性、品質指標
**確認項目**:
- テストカバレッジが要件を満たしているか？
- テストが十分なシナリオをカバーしているか？
- エッジケースがテストされているか？
- テストが独立しているか？

### テスト設計エンジニア
**観点**: テスト戦略、カバレッジ
**確認項目**:
- テスト戦略が適切か？
- 単体テストがあるか？
- 統合テストがあるか？
- エンドツーエンドテストがあるか？
- テストが保守可能か？

### コードレビューアー
**観点**: コード品質、保守性、可読性
**確認項目**:
- コードがクリーンか？
- コードが可読性が高いか？
- 適切な命名がされているか？
- 適切なコメントがあるか？
- 重複がないか？
- 技術的負債がないか？

### セキュリティスペシャリスト
**観点**: セキュリティ脆弱性
**確認項目**:
- SQLインジェクションの脆弱性がないか？
- XSSの脆弱性がないか？
- 認証認可が適切か？
- データ検証があるか？
- シークレットがハードコードされていないか？
- 安全な関数を使用しているか？

## 敵対的レビュー

### 実行

`swarm_adversarial_review` を実行:

```bash
/swarm_adversarial_review --diff [差分] --test_output [テスト出力]
```

### 判定

- **APPROVED**: コードは優れている。次のフェーズに進んでよい
- **NEEDS_CHANGES**: 実際の問題が見つかった。修正が必要
- **HALLUCINATING**: 敵対者が問題を捏造している。コードは優れている

### 3ストライクルール

- 3回の拒否後、タスクは失敗してバックログに戻る
- 拒否ごとに理由を文書化
- 修正後に再レビュー

## 品質ゲート

### 1. 型チェック

```bash
# TypeScript/JavaScript
tsc --noEmit

# Python
mypy . || ruff check

# Rust
cargo check

# Go
go vet ./...
```

### 2. リンティング

```bash
# TypeScript/JavaScript
eslint . --max-warnings 0

# Python
ruff lint || flake8 . --max-line-length=88

# Rust
cargo clippy -- -D warnings

# Go
golangci-lint run
```

### 3. フォーマットチェック

```bash
# TypeScript/JavaScript
prettier --check "**/*.{ts,tsx,js,jsx,json,md}"

# Python
black --check .

# Rust
cargo fmt --check

# Go
gofmt -l .
```

### 4. テスト

```bash
# TypeScript/JavaScript
npm test -- --coverage

# Python
pytest --cov

# Rust
cargo test

# Go
go test ./... -cover
```

### ゲートの結果

| ゲート | 結果 | 説明 |
|--------|------|------|
| 型チェック | [✓/✗] | [説明] |
| リンティング | [✓/✗] | [説明] |
| フォーマットチェック | [✓/✗] | [説明] |
| テスト | [✓/✗] | [説明] |

## テスト網羅性

### カバレッジ要件

- **重要パス**: 100% カバレッジ（TDD必須）
- **通常パス**: 80% 以上のカバレッジ
- **全体**: 70% 以上のカバレッジ

### カバレッジレポート

```text
File           | % Stmts | % Branch | % Funcs | % Lines |
---------------|---------|----------|---------|---------|
src/module.ts  |   85.2  |    72.5  |   90.0  |   86.3  |
src/utils.ts   |   92.3  |    85.0  |  100.0  |   93.1  |
---------------|---------|----------|---------|---------|
All files      |   88.7  |    78.5  |   95.0  |   89.5  |
```

### テスト種別

- [ ] ユニットテスト
- [ ] 統合テスト
- [ ] エンドツーエンドテスト
- [ ] コントラクトテスト（該当の場合）

## コード品質評価

### コードの健全性

| 項目 | 評価 | 説明 |
|------|------|------|
| 複雑度 | [1-5] | 1: 低い、5: 高い |
| 重複 | [1-5] | 1: 低い、5: 高い |
| 技術的負債 | [1-5] | 1: 低い、5: 高い |
| メンテナンス性 | [1-5] | 1: 低い、5: 高い |

### 保守性

| 項目 | 評価 | 説明 |
|------|------|------|
| 可読性 | [1-5] | 1: 低い、5: 高い |
| 命名 | [1-5] | 1: 低い、5: 高い |
| コメント | [1-5] | 1: 低い、5: 高い |
| ドキュメント | [1-5] | 1: 低い、5: 高い |

## セキュリティ評価

| カテゴリ | 評価 | 説明 |
|---------|------|------|
| SQLインジェクション | [✓/✗/?] | 脆弱性があるか？ |
| XSS | [✓/✗/?] | 脆弱性があるか？ |
| 認証認可 | [✓/✗/?] | 適切か？ |
| データ検証 | [✓/✗/?] | あるか？ |
| シークレット管理 | [✓/✗/?] | 安全か？ |

## 出力形式

```markdown
# 品質レビュー結果

**対象**: [実装コード]
**レビュー日時**: [日時]

## 判定: GO / CONDITIONAL / NO-GO

[判定の理由]

## Critical Issues

[重大な問題のリスト]

## High Priority Issues

[高優先度問題のリスト]

## Medium Priority Issues

[中優先度問題のリスト]

## 品質ゲートの結果

| ゲート | 結果 | 説明 |
|--------|------|------|
| 型チェック | [✓/✗] | [説明] |
| リンティング | [✓/✗] | [説明] |
| フォーマットチェック | [✓/✗] | [説明] |
| テスト | [✓/✗] | [説明] |

### ゲート失敗時の詳細
[ゲート失敗の詳細情報]

## テスト網羅性

### カバレッジレポート
[カバレッジレポート]

### テスト種別
- [ ] ユニットテスト
- [ ] 統合テスト
- [ ] エンドツーエンドテスト
- [ ] コントラクトテスト

### カバレッジ要件のチェック
- [ ] 重要パス: 100%
- [ ] 通常パス: 80%以上
- [ ] 全体: 70%以上

## コード品質評価

### コードの健全性
[コードの健全性の詳細]

### 保守性
[保守性の詳細]

## セキュリティ評価
[セキュリティ評価の詳細]

## 敵対的レビュー結果

### 判定: APPROVED / NEEDS_CHANGES / HALLUCINATING

[判定の説明]

### 発見された問題

| 問題ID | 優先度 | 説明 | ファイル | 行 |
|--------|--------|------|--------|-----|
| 1      | Critical| [説明]| [file]| [line]|

### 修正が必要な問題
[修正が必要な問題のリスト]

## ペルソナ別フィードバック

### QAエンジニア
[QAエンジニアのフィードバック]

### テスト設計エンジニア
[テスト設計エンジニアのフィードバック]

### コードレビューアー
[コードレビューアーのフィードバック]

### セキュリティスペシャリスト
[セキュリティスペシャリストのフィードバック]

## 推奨事項

### 優先度Critical
[推奨事項のリスト]

### 優先度High
[推奨事項のリスト]

### 優先度Medium
[推奨事項のリスト]
```

## 品質基準

- **GO**: Critical/High問題なし、全ての品質ゲートをパス、敵対的レビューAPPROVED
- **CONDITIONAL**: 軽微な問題あり、修正後に進めてよい
- **NO-GO**: 重大な問題あり、品質ゲート失敗、または敵対的レビューNEEDS_CHANGES

## 敵対的レビューNEEDS_CHANGES時の処理

1. 発見された問題をリスト化
2. ユーザーに確認: "敵対的レビューで問題が見つかりました。修正しますか？(yes/no)"
3. yesの場合: フィードバックに基づいて修正を開始
4. noの場合: ユーザーの指示を待つ

## 敵対的レビューHALLUCINATING時の処理

1. コード品質が優れていることを報告
2. 次のフェーズに進むことができる

## 次のステップ

- **GO**: `/review phase` でフェーズ完了レビュー
- **CONDITIONAL**: 問題を修正し、再レビュー
- **NO-GO**: 問題を修正し、再レビュー
